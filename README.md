# **Surge 教程**

## Surge Tutorial｜Surge 小白教程




## 一、订阅导入

打开自己购买订阅的机场



**情况一**：自带一键导入Surge
![图片 1](https://github.com/dhjhb/Surge/assets/101947375/c7e4e0e2-c2ea-42bb-8085-7f2051f9887a)

**情况二**：无一键导入
![图片 2](https://github.com/dhjhb/Surge/assets/101947375/e6cf1125-d90b-473f-ad04-e737a174c6e5)
导入成功🏅

## 二、启动Surge

![图片 3](https://github.com/dhjhb/Surge/assets/101947375/6a43e3fe-8cfe-4ff7-93ee-ab556064bda3)

**备注**：允许Surge添加VPN配置时会跳转至设置要求输入锁屏密码，正常输入即可

再次点击启动键会提示证书未信任，下面进行证书安装并信任。
![图片 4](https://github.com/dhjhb/Surge/assets/101947375/5596c6d0-0130-4f82-a775-c7117c1c3fe9)

此时会跳转至浏览器
在浏览器中完成以下操作
![图片 5](https://github.com/dhjhb/Surge/assets/101947375/c00044dd-05ab-4659-9b60-880641f203e8)

完成上面两步操作后来到系统设置进行证书安装和信任
![图片 6](https://github.com/dhjhb/Surge/assets/101947375/27904e52-523d-4797-a17d-397d4c2bfb43)
返回Surge可以看到证书系统已信任，可以正常使用了。

![图片 7](https://github.com/dhjhb/Surge/assets/101947375/cf5e4d63-58d0-4712-87fb-3de846b13e52)

**碎碎念**：出站模式的不同表示Surge对网络流量的接管程度不同。

  🚀直接连接表示Surge只进行简单的流量监看，不能实现“网络加速功能”。

  🌍全局代理模式下当前的所有流量将全部由Surge接管，通过当前选择的节点转发。

  🔀规则模式下的流量会按配置文件中的代理规则进行代理。一般机场的托管配置中设置的为可以国内直连的不通过代理，常见国外请求走预先选择的节点。（推荐使用，有省流、国内访问快等优点）

## 三、规则应用与策略组配置（规则模式）

**说明**：订阅机场给的众多节点并不是完全相同的，它们指向不同的国家，对不同网站或流媒体平台的支持效果也不同。一些机场的托管配置有对不同使用场景做适配，但个别时候还是需要自己去手动切换可用节点就十分麻烦。灵活运用Surge的策略功能便能方便的手动或自动切换节点。

**举个例子**🌰：当你要访问YouTube时，香港、台湾、新加坡的节点都可以访问，但如何将最快的可用节点指派给油管呢？这便要使用到规则与策略功能了。

![图片 8](https://github.com/dhjhb/Surge/assets/101947375/3dae4e88-7038-4361-a877-0002691e276b)
打开YouTube应用或网站后回到Surge，可以在工具的最近请求中找到明显来自YouTube的流量记录（明显带有“yt”、“google”、“gg”等流量记录也来自对油管的访问）。查看明细可以了解到我们的当前配置将带有“YouTube”关键词的访问流量被识别到并采用了分配给“香港｜HK03｜ND”这一具体节点的策略。


![图片 9](https://github.com/dhjhb/Surge/assets/101947375/c374d262-c0e4-46d6-accf-2497c8f25505)

这里可以对照[Surge使用手册](https://manual.nssurge.com/book/understanding-surge/cn/#转发代理和规则系统)来查看每一项的具体功能。下面是截取的部分。

![图片 10](https://github.com/dhjhb/Surge/assets/101947375/8a2b3147-52ff-4ec4-8942-76f7b894acc4)
配合不同规则类型的选择和简单的修改代理策略可以实现访问YouTube时走手动选择的固定节点。而要实现自动匹配某个国家的多个节点中最“合适”的，就要使用到策略组功能了。

![图片 11](https://github.com/dhjhb/Surge/assets/101947375/4a73acce-b8d2-4867-abed-cfaf15bcadf4)

在代理服务器中新增策略组，命名为YouTube，选择URL延迟自动测试（网速最快的节点、url-test）将下方可用的策略拖拽到包含的策略中后点击完成。

这时回到策略组会发现出现了名为YouTube的策略组。点击测速键会发现当前组启用的是延迟最低的节点（URL延迟自动测试的功能）

![图片 12](https://github.com/dhjhb/Surge/assets/101947375/3e51b18a-229b-48f8-abe0-81473fb97dbb)
利用这种方式我们可以将相同国家的节点放置在同一个策略组中，并使组内延迟最低的被调用。

![图片 13](https://github.com/dhjhb/Surge/assets/101947375/267ecddc-53dc-45c0-8d41-b4b1406eadc2)

此时距离实现我们的例子🌰就差最后一步了。将YouTube策略组中的代理策略替换成各个国家的策略组。这里可以长按YouTube策略组图标，编辑策略组，替换上国家策略组并将组类型改为select（手动选择）。

此时我们便达到了目的，但有几点问题还需解决。

1.一个策略组中添加大量节点时很不方便；

2.通过查看流量细节更改规则的方式很繁琐。

让我们先解决第一个问题。
那便是利用正则表达式进行关键词筛选（又提到了关键词呢）

我们这里以生成一个东亚的策略组为例。
在创建策略组时打开“包含所有代理策略”后会在最下方出现过滤器。通过半角“｜”间隔关键词可以将所有代理策略中含有所填关键词的节点筛选出来组成策略组。

![图片 14](https://github.com/dhjhb/Surge/assets/101947375/743e15c3-7348-4973-a8ce-49d99c656542)

同时我们可以将组类型为url-test的策略组隐藏起来，使得界面简洁。

（因为url-testl类型的策略组已经实现自动切换延迟最低节点，无需调整，可以隐藏）
那让我们带着第二个问题进行下一步骤吧

## 四、规则分流

**说明**：选择不同国家的代理节点访问相同的网站会有获得不同的内容和访问体验。

![图片 15](https://github.com/dhjhb/Surge/assets/101947375/68a2aca2-a837-4b46-b1d3-8e5b29a681c9)
例如用港澳台的节点访问bilibili可以观看大陆地区没有的内容。但这些内容的判定规则复杂，可能并不由单一的URL来决定。这就需要我们将来自bilibili的全部流量都指向一个国家策略组。


要想实现这个功能，解决第二个问题就迫在眉睫了。

这便要求我们掌握Surge中调用规则集的功能。

![图片 16](https://github.com/dhjhb/Surge/assets/101947375/603110e1-c10c-41a5-bd1a-66eecafe4680)

这里以添加GitHub的代理规则集为例。


在外部规则集填上

         https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/GitHub/GitHub.list

（也可以选择将链接文件下载后导入到Surge）

策略建议选择筛选所有节点中延迟最低的，以便于后续外部规则集使用时能更快与GitHub进行连接。
之后便可轻松访问[@blackmatrix7](https://github.com/blackmatrix7)大神的规则仓库来添加更多的规则集了。


# 规则仓库

    https://github.com/blackmatrix7/ios_rule_script

我们继续以YouTube的规则集添加为例。
![图片 17](https://github.com/dhjhb/Surge/assets/101947375/4bf34ff2-4fd9-40c1-8777-7d7c81d4da46)

找到适配Surge端的一条YouTube规则集链接并复制。

回到Surge编辑YouTube策略组，填入复制的规则集链接并完成保存。

![图片 18](https://github.com/dhjhb/Surge/assets/101947375/9d175ffd-d878-4bc7-aad9-5ba369d581cc)

此时使用YouTube产生的所有流量都将通过导入的规则集进行关键词审查，审查确认的流量都将通过通过YouTube策略组进行流量代理。	


至此我们便可以通过重复以上步骤实现其他应用的规则分流配置。

**<u>！！！这里再次强调，如果导入的外部规则集较多，且更新间隔较短。建议为GitHub专门配置稳定较快的策略组，以保证在流量关键词识别过程中不断连。！！！</u>**

碎碎念：在我看来“网络长城”的基本工作原理是通过识别访问请求中的关键词来嗅探你的访问远端地址，被列入黑名单的远端地址被墙也就访问不了了。梯子的功能正是反其道而行之，提前识别到要访问的远端并与规则集这个“白名单”对照，记录在册的也就通过各种绕墙或穿墙方式避开“网络长城”的拦截了。

后面更新通过配置文件直接编写来实现以上的步骤。



































